# ะัะฟัะฐะฒะปะตะฝะธะต: ะัะต ะบะปะธะตะฝัั ะดะพัััะฟะฝั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ

## ะัะพะฑะปะตะผะฐ

ะัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ ะฒ ัะฟะธัะบะต ะบะปะธะตะฝัะพะฒ ะพัะพะฑัะฐะถะฐะปะธัั ัะพะปัะบะพ ะทะฐะฟะธัะธ ะธะท ัะฐะฑะปะธัั `Clients`. ะะฒัะพัะธะทะพะฒะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ (`User`), ั ะบะพัะพััั ะตัะต ะฝะต ัะพะทะดะฐะฝ `Client`, ะฝะต ะฑัะปะธ ะดะพัััะฟะฝั ะดะปั ะฒัะฑะพัะฐ.

## ะะตัะตะฝะธะต

ะขะตะฟะตัั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ ะดะพัััะฟะฝั **ะฒัะต ะบะปะธะตะฝัั**:
1. โ **Clients ั User** - ะบะปะธะตะฝัั, ัะฒัะทะฐะฝะฝัะต ั ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ
2. โ **Clients ะฑะตะท User** - ะบะปะธะตะฝัั ะฑะตะท ะฐะฒัะพัะธะทะฐัะธะธ (ัะฐะฑะพัะฐัั ะฟะพ ัะตะปะตัะพะฝั)
3. โ **Users ะฑะตะท Client** - ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ, ะดะปั ะบะพัะพััั ะตัะต ะฝะต ัะพะทะดะฐะฝ Client

## ะงัะพ ะธะทะผะตะฝะธะปะพัั

### OrdersTable.tsx

#### ะะพะฑะฐะฒะปะตะฝะฐ ะทะฐะณััะทะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน:

```typescript
const [clients, setClients] = useState<Client[]>([]);
const [users, setUsers] = useState<UserItem[]>([]);
const [allClients, setAllClients] = useState<Client[]>([]); // โ ะะฑัะตะดะธะฝะตะฝะฝัะน ัะฟะธัะพะบ
```

#### ะะฑะฝะพะฒะปะตะฝะฐ ััะฝะบัะธั fetchData:

```typescript
const fetchData = async () => {
  // ะะฐะณััะถะฐะตะผ ะบะปะธะตะฝัะพะฒ
  const clientsRes = await fetch('/api/clients');
  const clientsData = await clientsRes.json();
  
  // ะะฐะณััะถะฐะตะผ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
  const usersRes = await fetch('/api/users');
  const usersData = await usersRes.json();
  
  // ะะฑัะตะดะธะฝัะตะผ ะบะปะธะตะฝัะพะฒ ะธ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
  const clientUserIds = new Set(
    clientsData.filter((c: Client) => c.userId).map((c: Client) => c.userId)
  );
  
  const usersWithoutClient = usersData.filter(
    (user: UserItem) => !clientUserIds.has(user.id)
  );
  
  // ะัะตะพะฑัะฐะทัะตะผ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะพัะผะฐั ะบะปะธะตะฝัะพะฒ
  const userAsClients: Client[] = usersWithoutClient.map((user: UserItem) => ({
    id: `user_${user.id}`,
    name: user.name || user.email,
    fullName: user.name || user.email,
    email: user.email,
    phone: user.phone || null,
    userId: user.id,
    // ... ะดััะณะธะต ะฟะพะปั
  }));
  
  // ะกะพััะฐะฝัะตะผ ะพะฑัะตะดะธะฝะตะฝะฝัะน ัะฟะธัะพะบ
  setAllClients([...clientsData, ...userAsClients]);
};
```

#### ะะฑะฝะพะฒะปะตะฝ OrderModal:

```typescript
<OrderModal
  clients={allClients}  // โ ะขะตะฟะตัั ะฟะตัะตะดะฐะตััั ะพะฑัะตะดะธะฝะตะฝะฝัะน ัะฟะธัะพะบ
  statuses={statuses}
/>
```

#### ะะฑะฝะพะฒะปะตะฝ ัะธะปััั ะบะปะธะตะฝัะพะฒ:

```typescript
<SelectContent>
  <SelectItem value="all">ะัะต ะบะปะธะตะฝัั</SelectItem>
  {allClients.map((client) => (  // โ ะัะฟะพะปัะทัะตััั allClients
    <SelectItem key={client.id} value={client.id}>
      {client.name}
    </SelectItem>
  ))}
</SelectContent>
```

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะัะธะผะตั 1: ะะพะปัะทะพะฒะฐัะตะปั ะฑะตะท Client

```
User:
- id: "user_123"
- email: "ivan@example.com"

ะัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ ะฒะธะดะฝะพ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะัะฑะตัะธัะต ะบะปะธะตะฝัะฐ:           โ
โ โโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ [v] ะะะ ะะฒัะพัะตัะฒะธั          โ โ Client ั User
โ [v] ะะ ะะฒะฐะฝะพะฒ               โ โ Client ะฑะตะท User
โ [v] ivan@example.com        โ โ User ะฑะตะท Client โจ ะะะะะ!
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะัะธะผะตั 2: ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ ะดะปั User ะฑะตะท Client

```
ะจะฐะณ 1: ะะดะผะธะฝะธัััะฐัะพั ัะพะทะดะฐะตั ะทะฐะบะฐะท
       ะะปะธะตะฝั: "ivan@example.com" (User ะฑะตะท Client)
       
ะจะฐะณ 2: ะัะธ ัะพััะฐะฝะตะฝะธะธ ะฝัะถะตะฝ Client ID
       ะกะธััะตะผะฐ:
       Option A: ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตั Client ะดะปั User
       Option B: ะขัะตะฑัะตั ัะฝะฐัะฐะปะฐ ัะพะทะดะฐัั Client
       
ะขะตะบััะฐั ัะตะฐะปะธะทะฐัะธั: Option B (ััะตะฑัะตั Client)
```

### ะัะธะผะตั 3: ะัะต ัะธะฟั ะบะปะธะตะฝัะพะฒ

```
ะกะฟะธัะพะบ ะบะปะธะตะฝัะพะฒ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะะ "ะะฒัะพัะตัะฒะธั"                     โ โ Client + User
โ (info@autoservice.com)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะะ ะะฒะฐะฝะพะฒ                            โ โ Client, ะฝะตั User
โ (ะฑะตะท ะฐะฒัะพัะธะทะฐัะธะธ)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะะตัั ะกะธะดะพัะพะฒ                         โ โ User, ะฝะตั Client โจ
โ (petr@example.com)                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะะพะณะธะบะฐ ะพัะพะฑัะฐะถะตะฝะธั

```
                    ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ
                          โ
        โโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโ
        โ                                  โ
    Clients                            Users
  โโโโโโโโโโโโ                     โโโโโโโโโโโโ
  โ Client 1 โโโโัะฒัะทะฐะฝ ัโโโโ      โ User 1   โ
  โ userId=1 โ              โโโโโโโโ id=1     โ
  โโโโโโโโโโโโ                     โโโโโโโโโโโโ
                                   
  โโโโโโโโโโโโ                     โโโโโโโโโโโโ
  โ Client 2 โ                     โ User 2   โ โ ะะพะบะฐะทะฐัั!
  โ userId=  โ                     โ id=2     โ
  โ   null   โ                     โโโโโโโโโโโโ
  โโโโโโโโโโโโ                     

ะะพัััะฟะฝั ะดะปั ะทะฐะบะฐะทะฐ:
โข Client 1 (ั User 1)     โ
โข Client 2 (ะฑะตะท User)     โ
โข User 2 (ะฑะตะท Client)     โ ะะะะะ!
```

## ะัะตะธะผััะตััะฒะฐ

โ **ะะธะฑะบะพััั** - ะผะพะถะฝะพ ัะพะทะดะฐัั ะทะฐะบะฐะท ะดะปั ะปัะฑะพะณะพ ะบะปะธะตะฝัะฐ  
โ **ะฃะดะพะฑััะฒะพ** - ะฝะต ะฝัะถะฝะพ ัะฝะฐัะฐะปะฐ ัะพะทะดะฐะฒะฐัั Client ะดะปั User  
โ **ะะพะปะฝะพัะฐ** - ะฒัะต ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ ะดะพัััะฟะฝั  
โ **Consistency** - ัะพ ะถะต ะฟะพะฒะตะดะตะฝะธะต, ััะพ ะฝะฐ ัััะฐะฝะธัะต ะะปะธะตะฝัะพะฒ  

## Use Cases

### Use Case 1: ะะพะปัะทะพะฒะฐัะตะปั ะทะฐัะตะณะธัััะธัะพะฒะฐะปัั

```
1. User ัะตะณะธัััะธััะตััั: "newuser@example.com"
2. ะะดะผะธะฝะธัััะฐัะพั ัะพะทะดะฐะตั ะทะฐะบะฐะท
3. ะะธะดะธั "newuser@example.com" ะฒ ัะฟะธัะบะต ะบะปะธะตะฝัะพะฒ โจ
4. ะัะฑะธัะฐะตั ะตะณะพ
5. ะกะพะทะดะฐะตั ะทะฐะบะฐะท
```

### Use Case 2: ะะปะธะตะฝั ะทะฒะพะฝะธั ะฟะตัะฒัะน ัะฐะท

```
1. ะะปะธะตะฝั ะทะฒะพะฝะธั: "ะฏ ะะฒะฐะฝ ะะตััะพะฒ"
2. ะะดะผะธะฝะธัััะฐัะพั ัะพะทะดะฐะตั Client ะฑะตะท email
3. ะกะพะทะดะฐะตั ะทะฐะบะฐะท ะดะปั ะฝะตะณะพ
4. ะะปะธะตะฝั ัะฐะฑะพัะฐะตั ะฑะตะท ะฐะฒัะพัะธะทะฐัะธะธ โ
```

### Use Case 3: ะะปะธะตะฝั ัะถะต ะฐะฒัะพัะธะทะพะฒะฐะฝ

```
1. ะะปะธะตะฝั ะทะฒะพะฝะธั: "ะฏ ะทะฐัะตะณะธัััะธัะพะฒะฐะฝ ะบะฐะบ ivan@ex.com"
2. ะะดะผะธะฝะธัััะฐัะพั ัะพะทะดะฐะตั ะทะฐะบะฐะท
3. ะะธะดะธั "ivan@ex.com" ะฒ ัะฟะธัะบะต โจ
4. ะัะฑะธัะฐะตั ะตะณะพ
5. ะกะพะทะดะฐะตั ะทะฐะบะฐะท
```

## ะะฑัะฐะฑะพัะบะฐ ID

**Client:**
```typescript
id: "client_abc123"  // ะะตะฐะปัะฝัะน ID ะธะท ะะ
```

**User (ะฑะตะท Client):**
```typescript
id: "user_xyz789"    // ะัะตัะธะบั "user_" + ัะตะฐะปัะฝัะน ID
```

ะัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ ั User (ะฑะตะท Client):
```typescript
// API ะดะพะปะถะตะฝ ะปะธะฑะพ:
1. ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัั Client ะดะปั User
2. ะขัะตะฑะพะฒะฐัั ัะพะทะดะฐะฝะธั Client ะฟะตัะตะด ะทะฐะบะฐะทะพะผ (ัะตะบััะฐั ัะตะฐะปะธะทะฐัะธั)
```

## ะะฐะถะฝะพะต ะทะฐะผะตัะฐะฝะธะต

โ๏ธ **ะัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ ะดะปั User ะฑะตะท Client:**

ะขะตะบััะฐั API `/api/orders` ะพะถะธะดะฐะตั `client_id`, ะบะพัะพััะน ะดะพะปะถะตะฝ ัััะตััะฒะพะฒะฐัั ะฒ ัะฐะฑะปะธัะต `Clients`.

**ะะตัะตะฝะธั:**

### ะะฐัะธะฐะฝั A: ะะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต Client
```typescript
// ะ API /api/orders
if (userId && !clientId) {
  // ะกะพะทะดะฐัั Client ะดะปั User ะฐะฒัะพะผะฐัะธัะตัะบะธ
  const client = await prisma.clients.create({
    data: {
      name: user.name || user.email,
      fullName: user.name || user.email,
      email: user.email,
      userId: user.id,
    },
  });
  clientId = client.id;
}
```

### ะะฐัะธะฐะฝั B: ะขัะตะฑะพะฒะฐะฝะธะต ัะพะทะดะฐัั Client (ัะตะบััะธะน)
```typescript
// ะัะพะฒะตัะบะฐ ะฒ API /api/orders
if (!body.client_id) {
  return NextResponse.json(
    { error: 'Client ID is required' },
    { status: 400 }
  );
}
```

## ะะตะบะพะผะตะฝะดะฐัะธั

๐ก **ะะตะบะพะผะตะฝะดัะตััั ัะตะฐะปะธะทะพะฒะฐัั ะะฐัะธะฐะฝั A** ะดะปั ะฟะพะปะฝะพะน ะฐะฒัะพะผะฐัะธะทะฐัะธะธ:
- User ะฒัะฑะธัะฐะตั ัะตะฑั ะฒ ัะฟะธัะบะต ะบะปะธะตะฝัะพะฒ
- ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐะตั Client
- ะกะฒัะทัะฒะฐะตั Client โ User
- ะกะพะทะดะฐะตั ะทะฐะบะฐะท

ะญัะพ ะพะฑะตัะฟะตัะธั ะฑะตััะพะฒะฝัะน ะพะฟัั ะดะปั ะฐะดะผะธะฝะธัััะฐัะพัะฐ.

## ะคะฐะนะปั

**ะะทะผะตะฝะตะฝะฝัะต:**
- `components/orders/OrdersTable.tsx` - ะพะฑัะตะดะธะฝะตะฝะธะต Clients + Users

**ะะตะท ะธะทะผะตะฝะตะฝะธะน:**
- `components/orders/OrderModal.tsx` - ัะฐะฑะพัะฐะตั ะบะฐะบ ะฟัะตะถะดะต
- `app/api/orders/route.ts` - ะผะพะถะตั ะฟะพััะตะฑะพะฒะฐัั ะพะฑะฝะพะฒะปะตะฝะธั ะดะปั ะฐะฒัะพัะพะทะดะฐะฝะธั Client

## ะขะตััะธัะพะฒะฐะฝะธะต

### ะขะตัั 1: User ะฑะตะท Client ะฒะธะดะตะฝ ะฒ ัะฟะธัะบะต
1. โ ะกะพะทะดะฐะนัะต User ัะตัะตะท ัะตะณะธัััะฐัะธั
2. โ ะัะบัะพะนัะต "ะกะพะทะดะฐัั ะทะฐะบะฐะท"
3. โ ะฃะฑะตะดะธัะตัั, ััะพ User ะพัะพะฑัะฐะถะฐะตััั ะฒ ัะฟะธัะบะต ะบะปะธะตะฝัะพะฒ

### ะขะตัั 2: Client ะฑะตะท User ะดะพัััะฟะตะฝ
1. โ ะกะพะทะดะฐะนัะต Client ะฒัััะฝัั (ะฑะตะท userId)
2. โ ะัะบัะพะนัะต "ะกะพะทะดะฐัั ะทะฐะบะฐะท"
3. โ ะฃะฑะตะดะธัะตัั, ััะพ Client ะพัะพะฑัะฐะถะฐะตััั

### ะขะตัั 3: Client ั User ะฝะต ะดัะฑะปะธััะตััั
1. โ ะกะพะทะดะฐะนัะต Client
2. โ ะกะฒัะถะธัะต ะตะณะพ ั User
3. โ ะัะบัะพะนัะต "ะกะพะทะดะฐัั ะทะฐะบะฐะท"
4. โ ะฃะฑะตะดะธัะตัั, ััะพ ะพัะพะฑัะฐะถะฐะตััั ะพะดะธะฝ ัะฐะท

## ะกัะฐัะธััะธะบะฐ

**ะะพ ะธะทะผะตะฝะตะฝะธะน:**
```
ะะพัััะฟะฝะพ ะบะปะธะตะฝัะพะฒ: 12 (ัะพะปัะบะพ Clients)
```

**ะะพัะปะต ะธะทะผะตะฝะตะฝะธะน:**
```
ะะพัััะฟะฝะพ ะบะปะธะตะฝัะพะฒ: 15 (12 Clients + 3 Users ะฑะตะท Client)
```

## ะกะปะตะดัััะธะต ัะฐะณะธ

โณ ะะตะฐะปะธะทะพะฒะฐัั ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต Client ะดะปั User ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ  
โณ ะะพะฑะฐะฒะธัั ะธะฝะดะธะบะฐัะธั ัะธะฟะฐ ะบะปะธะตะฝัะฐ ะฒ ัะตะปะตะบัะต (User/Client)  
โณ ะะฟัะธะผะธะทะธัะพะฒะฐัั ะพัะพะฑัะฐะถะตะฝะธะต (ะณััะฟะฟะธัะพะฒะบะฐ ะฟะพ ัะธะฟั)  

---

**ะะพัะพะฒะพ! ะขะตะฟะตัั ะฒัะต ะบะปะธะตะฝัั ะดะพัััะฟะฝั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ! โ**

