# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–∞–∫–∞–∑–æ–≤

## –î–∞—Ç–∞: 29 –æ–∫—Ç—è–±—Ä—è 2025

### ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### 1. –ú–æ–¥–µ–ª—å `Orders` - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è:

- **`userId`** (String?, optional) - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–æ–∑–¥–∞–≤—à–∏–π –∑–∞–∫–∞–∑
- **`totalAmount`** (Float?, optional) - –û–±—â–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
- **`discount`** (Float, default: 0) - –°–∫–∏–¥–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑
- **`notes`** (String?, optional) - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏/–ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É
- **`deliveryAddress`** (String?, optional) - –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- **`trackingNumber`** (String?, optional) - –ù–æ–º–µ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
- **`updatedAt`** (DateTime) - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### 2. –ú–æ–¥–µ–ª—å `OrderItems` - –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

- **`article`** (String, required) - –ê—Ä—Ç–∏–∫—É–ª –∑–∞–ø—á–∞—Å—Ç–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ autopart)
- **`description`** (String, required) - –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ autopart)
- **`autopart_id`** - –¢–µ–ø–µ—Ä—å **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ** –ø–æ–ª–µ (String?)
- **–ò–∑–º–µ–Ω–µ–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏**: `onDelete: Cascade` ‚Üí `onDelete: SetNull`

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø—á–∞—Å—Ç–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, –∑–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞—Ä—Ç–∏–∫—É–ª–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏.

#### 3. –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å `OrderStatusHistory` - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤:

```prisma
model OrderStatusHistory {
    id             String   @id @default(cuid())
    order_id       String
    orderStatus_id Int
    userId         String?
    comment        String?
    createdAt      DateTime @default(now())

    order       Orders        @relation(fields: [order_id], references: [id], onDelete: Cascade)
    orderStatus OrderStatuses @relation(fields: [orderStatus_id], references: [id])
    user        User?         @relation(fields: [userId], references: [id])
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –∫–∞–∂–¥–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—é —Å—Ç–∞—Ç—É—Å–∞

#### 4. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–≤—è–∑–∏:

- `User` ‚Üí `Orders` (–æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤)
- `User` ‚Üí `OrderStatusHistory` (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- `OrderStatuses` ‚Üí `OrderStatusHistory` (–∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤)

### üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ seed.ts:

#### –ó–∞–∫–∞–∑—ã —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç:
- –ü—Ä–∏–≤—è–∑–∫—É –∫ —Å–æ–∑–¥–∞–≤—à–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å—É–º–º—ã –∑–∞–∫–∞–∑–æ–≤
- –°–∫–∏–¥–∫–∏ –¥–ª—è –æ–ø—Ç–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è
- –ù–æ–º–µ—Ä–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–æ–∫
- –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

#### OrderItems —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç:
- –ê—Ä—Ç–∏–∫—É–ª –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö autoparts

#### –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤:
- **17 –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏** –¥–ª—è 6 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- –ü–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–æ–≤ –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

1. **–ö–æ–≥–¥–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞:**
   ```bash
   npx prisma migrate deploy
   ```

2. **–ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é:**
   ```bash
   psql -d your_database < lib/db/migrations/20251029125504_add_order_improvements_and_history/migration.sql
   ```

3. **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å seed –¥–∞–Ω–Ω—ã–µ:**
   ```bash
   npx prisma db seed
   ```

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: 
   - –ú–∏–≥—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ OrderItems, –∫–æ–ø–∏—Ä—É—è article –∏ description –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö Autoparts
   - –ù–æ–≤—ã–µ –ø–æ–ª—è Orders –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ nullable

2. **–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –¢–µ–ø–µ—Ä—å —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏ –ù–ï —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –Ω–µ–π –∏–∑ –∑–∞–∫–∞–∑–æ–≤
   - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–∞–∫–∞–∑—ã –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
   - OrderStatusHistory –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏ –±—ã—Å—Ç—Ä–æ
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `order_id` –∏ `createdAt` –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è seed:
- ‚úÖ 6 –∑–∞–∫–∞–∑–æ–≤ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- ‚úÖ 11 –ø–æ–∑–∏—Ü–∏–π –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ 17 –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–∫–∞–∑–∞

### üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å):
   - `GET /api/orders` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
   - `POST /api/orders` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
   - `GET /api/orders/[id]` - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
   - `PUT /api/orders/[id]` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
   - `PUT /api/orders/[id]/status` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
   - `GET /api/orders/[id]/history` - –∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

2. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI** (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å):
   - OrdersTable.tsx - —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
   - OrderModal.tsx - —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - OrderDetails.tsx - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
   - OrderStatusManager.tsx - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º
   - OrderStatusHistory.tsx - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

3. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç totalAmount –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–Ω–∞–∫–ª–∞–¥–Ω—ã–µ, —Å—á–µ—Ç–∞)



