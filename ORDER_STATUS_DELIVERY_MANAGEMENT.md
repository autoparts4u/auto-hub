# Управление статусами заказов и методами доставки

## Обзор

Добавлена возможность управления статусами заказов и методами доставки через веб-интерфейс в разделе "Справочники" (Dashboard → Общие).

## Компоненты

### 1. OrderStatusesPanel

**Расположение:** `components/general/OrderStatusesPanel.tsx`

**Функционал:**
- Просмотр всех статусов заказов
- Создание новых статусов с указанием:
  - Названия
  - Цвета (HEX)
  - Флага "Финальный" (isLast)
- Редактирование существующих статусов
- Удаление статусов (с проверкой на наличие заказов)
- Поиск по названию статуса

**Особенности:**
- Статусы с флагом `isLast` отмечаются специальным бадж-элементом
- Визуальное отображение цвета статуса
- Защита от удаления статусов, используемых в заказах

### 2. DeliveryMethodsPanel

**Расположение:** `components/general/DeliveryMethodsPanel.tsx`

**Функционал:**
- Просмотр всех методов доставки
- Создание новых методов доставки
- Редактирование существующих методов
- Удаление методов (с проверкой на наличие заказов)
- Поиск по названию метода

**Особенности:**
- Защита от удаления методов доставки, используемых в заказах
- Простой и понятный интерфейс

## API Endpoints

### Статусы заказов

#### GET /api/order-statuses
Получить список всех статусов заказов.

**Response:**
```json
[
  {
    "id": 1,
    "name": "Новый",
    "hexColor": "#3b82f6",
    "isLast": false
  }
]
```

#### POST /api/order-statuses
Создать новый статус.

**Request Body:**
```json
{
  "name": "В обработке",
  "hexColor": "#f59e0b",
  "isLast": false
}
```

#### GET /api/order-statuses/[id]
Получить конкретный статус по ID.

#### PUT /api/order-statuses/[id]
Обновить статус.

**Request Body:**
```json
{
  "name": "Готов к отправке",
  "hexColor": "#10b981",
  "isLast": false
}
```

#### DELETE /api/order-statuses/[id]
Удалить статус (только если нет заказов с этим статусом).

### Методы доставки

#### GET /api/delivery-methods
Получить список всех методов доставки.
- Query параметр `clientId` (опционально) - для получения методов доставки конкретного клиента

**Response:**
```json
[
  {
    "id": 1,
    "name": "Самовывоз",
    "hexColor": "#3b82f6"
  }
]
```

#### POST /api/delivery-methods
Создать новый метод доставки.

**Request Body:**
```json
{
  "name": "Новая Почта",
  "hexColor": "#ef4444"
}
```

#### GET /api/delivery-methods/[id]
Получить конкретный метод доставки по ID.

#### PUT /api/delivery-methods/[id]
Обновить метод доставки.

**Request Body:**
```json
{
  "name": "Укрпочта",
  "hexColor": "#06b6d4"
}
```

#### DELETE /api/delivery-methods/[id]
Удалить метод доставки (только если нет заказов с этим методом).

## Страница "Справочники"

**Расположение:** `app/dashboard/general/page.tsx`

Добавлены две новые вкладки:
- **Статусы заказов** - для управления статусами заказов
- **Методы доставки** - для управления методами доставки

Данные загружаются на стороне сервера при загрузке страницы и передаются в соответствующие компоненты.

## Безопасность

- Все операции создания, обновления и удаления доступны только администраторам
- Просмотр доступен всем авторизованным пользователям
- Защита от удаления данных, используемых в заказах

## Использование

1. Перейдите в раздел **Dashboard → Общие**
2. Выберите вкладку **Статусы заказов** или **Методы доставки**
3. Используйте форму в верхней части для создания новых записей
4. Нажмите иконку карандаша для редактирования
5. Нажмите иконку корзины для удаления (если запись не используется в заказах)
6. Используйте поле поиска для быстрого нахождения нужной записи

## Примечания

- При попытке удалить статус/метод доставки, используемый в заказах, система выведет ошибку с указанием количества заказов
- Изменение статуса/метода доставки применяется ко всем заказам, использующим его
- Цвета статусов отображаются в таблице заказов для быстрой визуальной идентификации

