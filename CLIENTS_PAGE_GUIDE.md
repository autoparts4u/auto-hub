# Руководство: Страница Клиенты

## Обзор

Страница **Клиенты** (`/dashboard/clients`) предоставляет полный функционал для управления клиентами с возможностью их последующей авторизации.

## Доступ

**URL:** `http://localhost:3000/dashboard/clients`

**Права:** Только для администраторов

## Функционал

### 1. 📊 Статистика клиентов

Отображается 4 блока статистики:
- **Всего клиентов** - общее количество
- **С авторизацией** (зеленый) - клиенты, связанные с пользователями
- **Без авторизации** (оранжевый) - клиенты без связи с User
- **С email** - клиенты с указанным email (готовы к связыванию)

### 2. 🔍 Поиск клиентов

Поиск работает по:
- Краткому названию
- Полному названию
- Email
- Телефону

Поиск происходит в реальном времени без перезагрузки страницы.

### 3. 📋 Таблица клиентов

**Столбцы:**
- **Клиент** - краткое и полное название
- **Контакты** - email и телефон (если указаны)
- **Адрес** - адрес доставки
- **Тип цены** - назначенный прайс-лист
- **Авторизация** - статус связи с пользователем:
  - ✅ Авторизован (зеленый) - показывает email пользователя
  - ❌ Не авторизован (оранжевый) - ожидает связывания
- **Создан** - дата создания клиента

### 4. ➕ Добавление нового клиента

#### Открыть форму:
Нажмите кнопку **"Добавить клиента"** в правом верхнем углу.

#### Заполнить форму:

**ОСНОВНАЯ ИНФОРМАЦИЯ** (обязательно):
```
Краткое название:  ООО Автосервис *
Полное название:   Общество с ограниченной ответственностью Автосервис *
```

**КОНТАКТНАЯ ИНФОРМАЦИЯ** (опционально):
```
Email:    info@example.com     (для связи с пользователем)
Телефон:  +380501234567         (для связи с пользователем)
Адрес:    ул. Главная, 123      (адрес доставки по умолчанию)
```

**НАСТРОЙКИ ЦЕН** (опционально):
```
Тип цены:  [Выбор из списка]    (автоматический подбор цен при заказе)
```

#### Создать:
Нажмите кнопку **"Создать клиента"**.

## Примеры использования

### Пример 1: Новый клиент с полными данными

```
Краткое название:  ООО "Рога и копыта"
Полное название:   Общество с ограниченной ответственностью "Рога и копыта"
Email:             info@rk.com
Телефон:           +380501234567
Адрес:             г. Киев, ул. Главная, д. 123
Тип цены:          Опт

→ Клиент создан
→ Статус: "Не авторизован" (оранжевый)
→ Можно создавать заказы
→ Позже можно связать с User
```

### Пример 2: Минимальные данные

```
Краткое название:  Петров Иван
Полное название:   Петров Иван Петрович

→ Клиент создан
→ Работает без email/phone
→ Связь с User вручную
```

### Пример 3: Клиент для оптовых продаж

```
Краткое название:  Автомагазин №7
Полное название:   ИП Иванов А.А.
Email:             shop7@auto.com
Телефон:           +380671234567
Адрес:             г. Одесса, ул. Центральная, 45
Тип цены:          Дилер (-15%)

→ Клиент создан
→ При заказе цены автоматически: дилерские
→ Email для связи с User готов
```

## Визуальная структура

```
┌─────────────────────────────────────────────────────────────┐
│  Клиенты                    [+ Добавить клиента]            │
│  Управление клиентами                                       │
├─────────────────────────────────────────────────────────────┤
│  🔍 [Поиск по имени, email, телефону...]                   │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │ Всего    │ │ С автор  │ │ Без автор│ │ С email  │       │
│  │   12     │ │    8     │ │    4     │ │   10     │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
├─────────────────────────────────────────────────────────────┤
│  Клиент       Контакты        Адрес    Тип цены  Авториз.  │
│  ────────────────────────────────────────────────────────── │
│  ООО "РК"     📧 info@rk.com  Главная  Опт       ✅ Да      │
│  ИП Иванов    📱 +380...      —        Розница   ❌ Нет     │
│  Петров       —                —        —         ❌ Нет     │
└─────────────────────────────────────────────────────────────┘
```

## Модальное окно создания клиента

```
┌─────────────────────────────────────────────┐
│  Добавить нового клиента                [×] │
│  ─────────────────────────────────────────  │
│                                             │
│  ОСНОВНАЯ ИНФОРМАЦИЯ                        │
│  Краткое название *   │ Полное название *   │
│  [________________]   │ [________________]  │
│                                             │
│  КОНТАКТНАЯ ИНФОРМАЦИЯ                      │
│  Email                │ Телефон             │
│  [________________]   │ [________________]  │
│                                             │
│  Адрес                                      │
│  [_____________________________________]    │
│                                             │
│  НАСТРОЙКИ ЦЕН                              │
│  Тип цены                                   │
│  [Выберите тип цены ▼]                     │
│                                             │
│  ℹ️ Что дальше?                             │
│  • Клиент создан без авторизации            │
│  • Вы можете создавать заказы               │
│  • Позже можно связать с пользователем      │
│                                             │
│  [Отмена]                 [Создать клиента] │
└─────────────────────────────────────────────┘
```

## Валидация

### ✅ Обязательные поля:
- Краткое название (не пустое)
- Полное название (не пустое)

### ⚠️ Ограничения:
- Email должен быть уникальным
- Телефон должен быть уникальным
- Email должен быть в правильном формате

### ❌ Ошибки:

**"Client with this email already exists"**
→ Клиент с таким email уже существует

**"Client with this phone already exists"**
→ Клиент с таким телефоном уже существует

## После создания клиента

### Что можно делать:

1. ✅ **Создавать заказы** для этого клиента
   - Перейти в "Заказы" → "Создать заказ"
   - Выбрать клиента из списка
   - Цены подберутся автоматически по типу цены

2. ✅ **Связать с пользователем** (когда клиент зарегистрируется)
   - Функционал связывания будет добавлен позже
   - API уже готово: `POST /api/clients/{id}/link-user`

3. ✅ **Редактировать данные** клиента
   - Функционал редактирования будет добавлен позже
   - API уже готово: `PUT /api/clients/{id}`

## Интеграция с заказами

При создании заказа:
```
1. Выбираете клиента: "ООО Рога и копыта"
   ↓
2. Видите тип цены: "Опт"
   ↓
3. Выбираете запчасть: "ABC123 - Фильтр"
   ↓
4. Цена автоматически: 400 (оптовая)
   ✅ Вместо 500 (розничной)
```

## Workflow

```
Создание → Работа без авторизации → Регистрация → Связывание
┌────────┐   ┌────────────────────┐   ┌───────────┐   ┌──────────┐
│ Админ  │   │ Админ создает      │   │ Клиент    │   │ Админ    │
│ создает│→  │ заказы для клиента │→  │ регистр.  │→  │ связывает│
│ клиента│   │ (по телефону)      │   │ в системе │   │ Client↔User│
└────────┘   └────────────────────┘   └───────────┘   └──────────┘
  userId=null                           User создан     userId=id
```

## Технические детали

### Компоненты:
- **`app/dashboard/clients/page.tsx`** - серверный компонент страницы
- **`components/clients/ClientsTable.tsx`** - таблица клиентов
- **`components/clients/ClientModal.tsx`** - модальное окно создания

### API endpoints:
- **GET** `/api/clients` - получить список клиентов
- **POST** `/api/clients` - создать клиента
- **GET** `/api/clients/{id}` - получить клиента
- **PUT** `/api/clients/{id}` - обновить клиента
- **DELETE** `/api/clients/{id}` - удалить клиента

### TypeScript типы:
```typescript
interface Client {
  id: string;
  name: string;          // Краткое название
  fullName: string;      // Полное название
  email: string | null;  // Для связи с User
  phone: string | null;  // Для связи с User
  address: string | null;
  priceAccessId: number | null;
  userId: string | null; // Связь с User
  priceAccess?: PriceType;
  user?: {
    id: string;
    name: string | null;
    email: string;
    phone: string | null;
  };
  createdAt: Date | string;
  updatedAt: Date | string;
}
```

## Следующие шаги

### Уже готово:
- ✅ Страница клиентов
- ✅ Таблица с фильтрацией
- ✅ Модальное окно создания
- ✅ Статистика
- ✅ Индикаторы авторизации

### Планируется:
1. ⏳ Редактирование клиента
2. ⏳ Удаление клиента
3. ⏳ Связывание с пользователем (UI)
4. ⏳ История заказов клиента
5. ⏳ Импорт клиентов из Excel

## Troubleshooting

### Клиент не создается
- Проверьте консоль браузера (F12)
- Проверьте обязательные поля
- Проверьте уникальность email/phone

### Не показывается тип цены
- Убедитесь, что типы цен созданы в системе
- Проверьте раздел "Общие" → "Типы цен"

### Статистика не обновляется
- Перезагрузите страницу (F5)
- Проверьте подключение к API

---

**Откройте http://localhost:3000/dashboard/clients и начните добавлять клиентов! 🎉**

